---
apiVersion: devopstoolkit.ai/v2
kind: Cluster
metadata:
  name: (join('-', ['a-team', $cluster]))
  namespace: ($namespace)
spec:
  parameters:
    usage:
      enabled: true
  (crossplane.resourceRefs[?name == join('-', ['a-team', $cluster, $usageName, 'usage'])]):
  - apiVersion: protection.crossplane.io/v1beta1
    kind: Usage
---
apiVersion: protection.crossplane.io/v1beta1
kind: Usage
metadata:
  annotations:
    crossplane.io/composition-resource-name: (join('-', ['a-team', $cluster, $usageName, 'usage']))
    crossplane.io/external-name: (join('-', ['a-team', $cluster, $usageName, 'usage']))
  name: (join('-', ['a-team', $cluster, $usageName, 'usage']))
spec:
  of:
    apiVersion: ($clusterApi)
    kind: ($clusterKind)
    resourceRef:
      name: (join('-', ['a-team', $cluster]))
  by:
    apiVersion: kubernetes.m.crossplane.io/v1alpha1
    kind: Object
    resourceRef:
      name: (join('-', ['a-team', $cluster, $usageName]))
